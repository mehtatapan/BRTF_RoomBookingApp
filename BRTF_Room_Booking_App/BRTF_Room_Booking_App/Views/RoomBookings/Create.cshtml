@model BRTF_Room_Booking_App.Models.RoomBooking

@{ ViewData["Title"] = "Create"; }
<body style="background-color:#E4E6E6" class="align-items-center text-center justify-content-center">
    <h1 class="mb-4">Book a Room</h1>

    <section style="background-color: #FFF;display: block; border-radius: 8px; box-shadow: 0 15px 25px rgba(0,0,50,0.2);" class="px-5 py-2 my-3">
        <div>
            <h4>Create New Booking</h4>
        </div>
        <div>
            <div class="container">

                <form asp-action="Create">
                    <div class="row form-group">
                        <div class="col-2 text-right pt-2">
                            <label asp-for="UserID" class="control-label">Full Name:</label>
                        </div>
                        <div class="col-10">
                            <select asp-for="UserID" class="form-control" asp-items="ViewBag.UserID"></select>
                            <span asp-validation-for="UserID" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-2 text-right pt-2">
                            <label asp-for="SpecialNotes" class="control-label">Special Notes:</label>
                        </div>
                        <div class="col-10">
                            <textarea asp-for="SpecialNotes" class="form-control"></textarea>
                            <span asp-validation-for="SpecialNotes" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-2 text-right pt-2">
                            <label asp-for="StartDate" class="control-label">Start:</label>
                        </div>
                        <div class="col-5">
                            <input asp-for="StartDate" class="form-control" />
                            <span asp-validation-for="StartDate" class="text-danger"></span>
                        </div>
                        <div class="col-5">
                            <select asp-for="StartTimeID" class="form-control" asp-items="ViewBag.StartTimeID"></select>
                            <span asp-validation-for="StartTimeID" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-2 text-right pt-2">
                            <label for="EndDate" class="control-label">End:</label>
                        </div>
                        <div class="col-5">
                            <input type="date" id="EndDate" name="EndDate" class="form-control" disabled />@* Note: This end date is only used as a display. It does not save data *@
                        </div>
                        <div class="col-5">
                            <select asp-for="EndTimeID" class="form-control" asp-items="ViewBag.EndTimeID"></select>
                            <span asp-validation-for="EndTimeID" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-2 text-right pt-2">
                            <label for="RoomGroupID" class="control-label">Area:</label>
                        </div>
                        <div class="col-10">
                            <select id="RoomGroupID" name="RoomGroupID" class="form-control" asp-items="ViewBag.RoomGroupID"></select>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-md-6">
                            <label for="selectedOptions" class="control-label"> Current Rooms to Book</label> <button type="button" title="Remove Rooms from Booking" id="btnRight" class="btn btn-danger btn-sm">
                                <strong>➖</strong>
                            </button>
                            @Html.ListBox("selectedOptions", (MultiSelectList)ViewBag.selOpts, new { @size = 10, @class = "form-control", @style = "height: 90%;" })
                            <span asp-validation-for="RoomID" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="availOptions" class="control-label"> Add Rooms to Booking</label> <button type="button" title="Add Rooms to Booking" id="btnLeft" class="btn btn-success btn-sm">
                                <strong>➕</strong>
                            </button>
                            @Html.ListBox("availOptions", (MultiSelectList)ViewBag.availOpts, new { @size = 10, @class = "form-control", @style = "height: 90%;" })
                        </div>
                    </div>

                    <div>
                        <label for="chkRepeat" class="control-label">Repeat?</label>
                        <input type="checkbox" id="chkRepeat" name="chkRepeat" class="control-label" @Html.Raw(ViewBag.chkRepeat) data-toggle="collapse" data-target="#collapseRepeat" aria-expanded="false" aria-controls="collapseRepeat" />
                    </div>
                    <div class="collapse @(ViewData["RepeatContainer"])" id="collapseRepeat">
                        <div class="container">
                            <div class="row">
                                <div class="col-2 text-right">
                                    <label for="RepeatInterval" class="control-label">Every:</label>
                                </div>
                                <div class="col-5">
                                    <input type="number" id="RepeatInterval" name="RepeatInterval" step="1" min="1" value="@(ViewData["RepeatInterval"])" class="form-control" />
                                    <span class="text-danger field-validation-valid" data-valmsg-for="RepeatInterval" data-valmsg-replace="true"></span>
                                </div>
                                <div class="col-5">
                                    <select id="RepeatType" name="RepeatType" class="form-control" asp-items="ViewBag.RepeatType"></select>
                                </div>
                            </div>
                            <div class="container mt-3">
                                <div class="row">
                                    <div class="col">
                                        <input type="checkbox" id="Monday" name="Monday" @Html.Raw(ViewBag.Monday) style="width: 20px; height: 20px;" />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Tuesday" name="Tuesday" @Html.Raw(ViewBag.Tuesday) style="width: 20px; height: 20px;" />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Wednesday" name="Wednesday" @Html.Raw(ViewBag.Wednesday) style="width: 20px; height: 20px; " />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Thursday" name="Thursday" @Html.Raw(ViewBag.Thursday) style="width: 20px; height: 20px; " />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Friday" name="Friday" @Html.Raw(ViewBag.Friday) style="width: 20px; height: 20px; " />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Saturday" name="Saturday" @Html.Raw(ViewBag.Saturday) style="width: 20px; height: 20px; " />
                                    </div>
                                    <div class="col">
                                        <input type="checkbox" id="Sunday" name="Sunday" @Html.Raw(ViewBag.Sunday) style="width: 20px; height: 20px; " />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="Monday" class="control-label">Mon</label>
                                    </div>
                                    <div class="col">
                                        <label for="Tuesday" class="control-label">Tue</label>
                                    </div>
                                    <div class="col">
                                        <label for="Wednesday" class="control-label">Wed</label>
                                    </div>
                                    <div class="col">
                                        <label for="Thursday" class="control-label">Thu</label>
                                    </div>
                                    <div class="col">
                                        <label for="Friday" class="control-label">Fri</label>
                                    </div>
                                    <div class="col">
                                        <label for="Saturday" class="control-label">Sat</label>
                                    </div>
                                    <div class="col">
                                        <label for="Sunday" class="control-label">Sun</label>
                                    </div>
                                </div>
                            </div>
                            <div class="container">
                                <div class="row">
                                    <div class="col-2 text-right pt-2">
                                        <label for="RepeatEndDate" class="control-label">Repeat End Date:</label>
                                    </div>
                                    <div class="col-5">
                                        <input type="date" id="RepeatEndDate" name="RepeatEndDate" value="@(ViewData["RepeatEndDate"])" class="form-control" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-group mt-3">
                        <input type="submit" value="Create" class="btn btn-primary mx-2" style="width:100px;" />
                        <a asp-action="Index" role="button" class="btn btn-secondary mx-2">Back to Bookings</a>
                    </div>
                </form>
            </div>
        </div>
    </section>
</body>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/js/multiselect.js"></script>
    <script src="~/js/refreshListbox.js"></script>
    <script type="text/javascript">
        // Reload certain input fields when page loads
        $(document).ready(function () {
            // Fill end date display field. (Note: This end date is only used as a display. It does not save data)
            var date = $('#StartDate')[0].valueAsDate;
            if ($("#EndTimeID option:selected").text().toLowerCase().includes("end"))
                date.setDate(date.getDate() + 1);
            $('#EndDate')[0].valueAsDate = date;
        });
        // Refresh Listbox of available rooms when Area is changed
        $('#RoomGroupID').change(function () {
            var selectedRoomGroup = $("#RoomGroupID").val();
            var URL = "/RoomBookings/GetRooms/" + selectedRoomGroup;
            $("#selectedOptions").empty();  // Empty previously selected rooms because the area changed
            refreshListbox('availOptions', URL, true, 'There are no Rooms available in this Area.', true);
        });
        // Update non-repeat end date display when Start Date is changed
        // (Note: This end date is only used as a display. It does not save data)
        $('#StartDate').change(function () {
            var date = this.valueAsDate;
            if ($("#EndTimeID option:selected").text().toLowerCase().includes("end"))
                date.setDate(date.getDate() + 1);
            $('#EndDate')[0].valueAsDate = date;
        });
        // Update non-repeat end date display when End Time is changed
        // (Note: This end date is only used as a display. It does not save data)
        $('#EndTimeID').change(function () {
            var date = $('#StartDate')[0].valueAsDate;
            if ($("#EndTimeID option:selected").text().toLowerCase().includes("end"))
                date.setDate(date.getDate() + 1);
            $('#EndDate')[0].valueAsDate = date;
        });
    </script>
}
